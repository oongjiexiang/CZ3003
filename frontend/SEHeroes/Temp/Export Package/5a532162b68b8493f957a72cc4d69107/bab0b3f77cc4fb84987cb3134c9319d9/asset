using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Networking;
using SimpleJSON;
using System.Linq;

public static class APIController
{
    public static List<JSONNode> allQA = new List<JSONNode>();
    private static readonly string baseStoryModeQuesAPIURL = "https://seheroes.herokuapp.com/storyModeQuestion?";
    private static readonly string baseAssQuesAPIURL = "https://seheroes.herokuapp.com/assignmentQuestion?assignmentId=";
    public static bool APIdone = false;

    // Get Story Mode Questions and Answers
    public static IEnumerator GetStoryModeQuesAPI() {
        APIdone = false;
        string QuesURL = baseStoryModeQuesAPIURL +
                                "world=" +ProgramStateController.world +
                                    "&section=" + ProgramStateController.section +
                                        "&level=" + ProgramStateController.level;
        UnityWebRequest quesRequest = UnityWebRequest.Get(QuesURL);
        yield return quesRequest.SendWebRequest();

        if (quesRequest.isNetworkError || quesRequest.isHttpError)
        {
            Debug.LogError(quesRequest.error);
            yield break;
        }

        JSONNode quesInfo = JSON.Parse(quesRequest.downloadHandler.text);
        for (int i = 0; i < quesInfo.Count; i++)
            BattleSceneController.allQA.Add(quesInfo[i]);

        APIdone = true;
    }
    public static IEnumerator GetAssignmentQuesAPI() {
        APIdone = false;
        string QuesURL = baseAssQuesAPIURL + ProgramStateController.assID;
        UnityWebRequest quesRequest = UnityWebRequest.Get(QuesURL);
        yield return quesRequest.SendWebRequest();

        if (quesRequest.isNetworkError || quesRequest.isHttpError)
        {
            Debug.LogError(quesRequest.error);
            yield break;
        }

        JSONNode quesInfo = JSON.Parse(quesRequest.downloadHandler.text);
        for (int i = 0; i < quesInfo.Count; i++)
            AssignmentBattleSceneController.allQA.Add(quesInfo[i]);

        APIdone = true;
    }
}